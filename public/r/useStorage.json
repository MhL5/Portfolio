{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "useStorage",
  "type": "registry:hook",
  "title": "useStorage",
  "description": "Hooks for localStorage and sessionStorage with React state synchronization.",
  "files": [
    {
      "path": "src/registry/hooks/useStorage/useStorage.ts",
      "content": "\"use client\";\n\nimport {\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n  useSyncExternalStore,\n} from \"react\";\n\nfunction useLocalStorage<T>(key: string, defaultValue: T | (() => T)) {\n  const defaultVal = useMemo(() => {\n    return defaultValue instanceof Function ? defaultValue() : defaultValue;\n  }, [defaultValue]);\n\n  const value = useSyncExternalStore(\n    (cb) => _subscribe(key, cb),\n    () => _getSnapshot(key, defaultVal, localStorage),\n    () => defaultVal,\n  );\n\n  const setValue = useCallback(\n    (newValue: T) => {\n      localStorage.setItem(key, JSON.stringify(newValue));\n      window.dispatchEvent(new StorageEvent(\"storage\", { key }));\n    },\n    [key],\n  );\n\n  return [value, setValue] as const;\n}\n\nfunction useSessionStorage<T>(key: string, defaultValue: T | (() => T)) {\n  const [value, setValue] = useState<T>(() =>\n    _getSnapshot(key, defaultValue, sessionStorage),\n  );\n\n  useEffect(() => {\n    sessionStorage.setItem(key, JSON.stringify(value));\n  }, [key, value]);\n\n  return [value, setValue] as const;\n}\n\nfunction _subscribe(key: string, callback: () => void) {\n  const handler = (e: StorageEvent) => {\n    if (e.key === key) callback();\n  };\n  window.addEventListener(\"storage\", handler);\n  return () => window.removeEventListener(\"storage\", handler);\n}\n\nfunction _getSnapshot<T>(key: string, defaultValue: T, storageObject: Storage) {\n  try {\n    const item = storageObject.getItem(key);\n    if (item) return JSON.parse(item);\n    if (defaultValue instanceof Function) return defaultValue();\n    return defaultValue;\n  } catch (error) {\n    // optional error handling for development\n    if (process.env.NODE_ENV === \"development\")\n      throw new Error(error instanceof Error ? error.message : \"Unknown error\");\n\n    return defaultValue;\n  }\n}\n\nexport { useLocalStorage, useSessionStorage };\n",
      "type": "registry:hook"
    }
  ]
}